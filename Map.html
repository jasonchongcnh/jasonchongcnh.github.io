<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>基於高斯濺射與北斗衛星導航系統的新型全息地圖</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0b1020;
            --panel: rgba(15, 23, 42, 0.72);
            --panel-border: rgba(148, 163, 184, 0.25);
            --text: #e2e8f0;
            --muted: #94a3b8;
            --accent: #38bdf8;
            --accent-strong: #22d3ee;
            --shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
        }

        html, body, #container {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-family: "Inter", "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            color: var(--text);
            background: var(--bg);
        }

        body {
            position: relative;
            overflow: hidden;
        }

        #container {
            filter: saturate(1.1) contrast(1.05);
        }

        .map-overlay {
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 20% 20%, rgba(34, 211, 238, 0.18), transparent 40%),
                radial-gradient(circle at 80% 10%, rgba(99, 102, 241, 0.2), transparent 35%),
                linear-gradient(180deg, rgba(2, 6, 23, 0.2), rgba(2, 6, 23, 0.5));
            mix-blend-mode: screen;
            pointer-events: none;
            z-index: 5;
        }

        .map-overlay::after {
            content: "";
            position: absolute;
            inset: 0;
            background-image: linear-gradient(rgba(148, 163, 184, 0.08) 1px, transparent 1px),
            linear-gradient(90deg, rgba(148, 163, 184, 0.08) 1px, transparent 1px);
            background-size: 48px 48px;
            opacity: 0.2;
        }

        .glass-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            width: min(420px, 90vw);
            padding: 18px 18px 14px;
            border-radius: var(--radius);
            background: var(--panel);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(16px);
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .glass-panel::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.5), rgba(99, 102, 241, 0.35));
            -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

        .panel-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.2px;
        }

        .panel-subtitle {
            margin: 0 0 12px 0;
            font-size: 12px;
            color: var(--muted);
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(56, 189, 248, 0.15);
            color: var(--accent);
            font-size: 12px;
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--accent-strong);
            box-shadow: 0 0 12px rgba(34, 211, 238, 0.9);
            animation: pulse 1.8s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.9);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(0.9);
                opacity: 0.6;
            }
        }

        .status-pill span {
            margin: 0;
        }

        .info {
            width: 100%;
        }

        .info h4 {
            margin: 0 0 10px;
            font-size: 14px;
            font-weight: 600;
        }

        .info p {
            margin: 0;
            font-size: 13px;
            color: var(--muted);
            line-height: 1.6;
        }

        .divider {
            height: 1px;
            margin: 12px 0;
            background: linear-gradient(90deg, transparent, rgba(148, 163, 184, 0.4), transparent);
            border: none;
        }

        .content-window-card {
            position: relative;
            box-shadow: 0 12px 30px rgba(2, 8, 23, 0.25);
            bottom: 0;
            left: 0;
            width: 340px;
            height: auto;
            padding: 0;
            border-radius: 14px;
            overflow: hidden;
        }

        .custom-info {
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 14px;
            background: #0f172a;
            color: #e2e8f0;
        }

        div.info-top {
            position: relative;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.25), rgba(34, 211, 238, 0.2));
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 14px 14px 0 0;
        }

        div.info-top div {
            display: inline-block;
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 600;
            line-height: 36px;
            padding: 0 14px;
        }

        div.info-top img {
            position: absolute;
            top: 9px;
            right: 10px;
            transition-duration: 0.25s;
            filter: brightness(1.2);
        }

        div.info-top img:hover {
            box-shadow: 0px 0px 8px rgba(56, 189, 248, 0.6);
        }

        div.info-middle {
            font-size: 12.5px;
            padding: 12px 12px 14px;
            line-height: 1.6;
            background-color: #0f172a;
        }

        div.info-middle a {
            color: var(--accent-strong);
            text-decoration: none;
            font-weight: 600;
        }

        div.info-middle a:hover {
            text-decoration: underline;
        }

        div.info-bottom {
            height: 0px;
            width: 100%;
            clear: both;
            text-align: center;
        }

        div.info-bottom img {
            position: relative;
            z-index: 104;
        }

        span {
            margin-left: 6px;
            font-size: 11px;
        }

        .info-middle img {
            float: left;
            width: 64px;
            height: 64px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .map-legend {
            position: absolute;
            right: 20px;
            top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 12px 14px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.75);
            border: 1px solid rgba(148, 163, 184, 0.25);
            color: var(--text);
            font-size: 12px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--accent);
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.6);
        }

        .legend-dot.school {
            background: #60a5fa;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.7);
        }

        .legend-dot.museum {
            background: #fbbf24;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.7);
        }

        @media (max-width: 720px) {
            .glass-panel {
                top: 12px;
                left: 12px;
                right: 12px;
                width: auto;
            }

            .map-legend {
                top: auto;
                bottom: 16px;
                right: 12px;
                left: 12px;
                flex-direction: row;
                justify-content: space-around;
            }

            .content-window-card {
                width: 300px;
            }
        }
    </style>
</head>
<body>
<div id="container"></div>
<div class="map-overlay"></div>
<div class="glass-panel">
    <div class="panel-title">
        <span>澳門全息地圖</span>
        <span class="status-pill"><span class="status-dot"></span>定位 <span id="status">準備中</span></span>
    </div>
    <p class="panel-subtitle">基於高斯濺射與北斗衛星導航系統的新型全息地圖</p>
    <div class="info">
        <h4>定位資訊</h4>
        <hr class="divider">
        <p id="result">正在獲取定位資訊，請稍候。</p>
    </div>
</div>
<div class="map-legend">
    <div class="legend-item">
        <span class="legend-dot school"></span>
        <span>學校地標</span>
    </div>
    <div class="legend-item">
        <span class="legend-dot museum"></span>
        <span>博物館地標</span>
    </div>
</div>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=e1f470c32fc2df3f783099676f76ff49"></script>
<script type="text/javascript">
    // Initialize the map
    var map = new AMap.Map("container", {
        resizeEnable: true,
        center: [113.541765, 22.186945], // Set the map center to these coordinates
        zoom: 16, // Set the zoom level
        mapStyle: 'amap://styles/darkblue'
    });

    function createPin(color) {
        var svg = "<svg xmlns='http://www.w3.org/2000/svg' width='36' height='48' viewBox='0 0 36 48'>" +
            "<defs><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'>" +
            "<feGaussianBlur stdDeviation='2.5' result='coloredBlur'/>" +
            "<feMerge><feMergeNode in='coloredBlur'/><feMergeNode in='SourceGraphic'/></feMerge>" +
            "</filter></defs>" +
            "<path d='M18 1.5C10.6 1.5 4.5 7.6 4.5 15c0 10.5 13.5 31.5 13.5 31.5S31.5 25.5 31.5 15C31.5 7.6 25.4 1.5 18 1.5z' fill='" + color + "' filter='url(#glow)'/>" +
            "<circle cx='18' cy='15' r='5.5' fill='#0b1020'/></svg>";
        return new AMap.Icon({
            size: new AMap.Size(36, 48),
            image: 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg),
            imageSize: new AMap.Size(36, 48)
        });
    }

    var schoolIcon = createPin('#60a5fa');
    var museumIcon = createPin('#fbbf24');

    // Add geolocation functionality
    AMap.plugin('AMap.Geolocation', function() {
        var geolocation = new AMap.Geolocation({
            enableHighAccuracy: true, // 是否使用高精度定位，默认:true
            timeout: 10000, // 超过10秒后停止定位，默认：5s
            buttonPosition: 'RB', // 定位按钮的停靠位置
            buttonOffset: new AMap.Pixel(10, 20), // 定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            zoomToAccuracy: true // 定位成功后是否自动调整地图视野到定位点
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition(function(status, result) {
            if (status == 'complete') {
                onComplete(result);
            } else {
                onError(result);
            }
        });
    });

    // Parse geolocation results
    function onComplete(data) {
        document.getElementById('status').innerHTML = '定位成功';
        var str = [];
        str.push('定位结果：' + data.position);
        str.push('定位类别：' + data.location_type);
        if (data.accuracy) {
            str.push('精度：' + data.accuracy + ' 米');
        } // 如为IP精确定位结果则没有精度信息
        str.push('是否经过偏移：' + (data.isConverted ? '是' : '否'));
        document.getElementById('result').innerHTML = str.join('<br>');
    }

    // Parse geolocation error
    function onError(data) {
        document.getElementById('status').innerHTML = '定位失败';
        document.getElementById('result').innerHTML = '失败原因排查信息:' + data.message;
    }

    // Add markers to the map
    addMarker();
    addSecondMarker();

    // Add the first marker
    function addMarker() {
        var marker = new AMap.Marker({
            map: map,
            position: [113.541765, 22.186945], // Marker position
            icon: schoolIcon,
            offset: new AMap.Pixel(-18, -42)
        });
        AMap.event.addListener(marker, 'click', function() {
            infoWindow.open(map, marker.getPosition());
        });
    }

    // Add the second marker
    function addSecondMarker() {
        var secondMarker = new AMap.Marker({
            map: map,
            position: [113.562085, 22.18336], // Set the position of the second marker
            icon: museumIcon,
            offset: new AMap.Pixel(-18, -42)
        });
        AMap.event.addListener(secondMarker, 'click', function() {
            secondInfoWindow.open(map, secondMarker.getPosition());
        });
    }

    // Create the first info window
    var title = '澳門慈幼中學<span style="font-size:11px;color:#F00;">學校</span>',
        content = [];
    content.push("<img src='./Image/IS_School_Macau.png'>Address: 澳門風順堂街十六號");
    content.push("Phone: (853) 2857 3033");
    content.push("<a href='http://ism.edu.mo'>More Info</a>");
    var infoWindow = new AMap.InfoWindow({
        isCustom: true,
        content: createInfoWindow(title, content.join("<br/>")),
        offset: new AMap.Pixel(16, -45)
    });

    // Create the second info window
    var secondTitle = '澳門科學館<span style="font-size:11px;color:#F00;">博物館</span>',
        secondContent = [];
    secondContent.push("<img src='./Image/MSC.jpg'>Address: 澳門孫逸仙大馬路");
    secondContent.push("Phone: (853) 2888 0822");
    secondContent.push("<a href='https://www.msc.org.mo/zh'>More Info</a>");
    var secondInfoWindow = new AMap.InfoWindow({
        isCustom: true,
        content: createInfoWindow(secondTitle, secondContent.join("<br/>")),
        offset: new AMap.Pixel(16, -45)
    });

    // Build the custom info window
    function createInfoWindow(title, content) {
        var info = document.createElement("div");
        info.className = "custom-info input-card content-window-card";

        var top = document.createElement("div");
        var titleD = document.createElement("div");
        var closeX = document.createElement("img");
        top.className = "info-top";
        titleD.innerHTML = title;
        closeX.src = "https://webapi.amap.com/images/close2.gif";
        closeX.onclick = closeInfoWindow;

        top.appendChild(titleD);
        top.appendChild(closeX);
        info.appendChild(top);

        var middle = document.createElement("div");
        middle.className = "info-middle";
        middle.style.backgroundColor = '#0f172a';
        middle.innerHTML = content;
        info.appendChild(middle);

        var bottom = document.createElement("div");
        bottom.className = "info-bottom";
        bottom.style.position = 'relative';
        bottom.style.top = '0px';
        bottom.style.margin = '0 auto';
        var sharp = document.createElement("img");
        sharp.src = "https://webapi.amap.com/images/sharp.png";
        bottom.appendChild(sharp);
        info.appendChild(bottom);
        return info;
    }

    // Close the info window
    function closeInfoWindow() {
        map.clearInfoWindow();
    }
</script>
</body>
</html>
